<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>İşletme Yönetimi - Galeri</title>
  <link rel="stylesheet" href="styles15.css" />
  <script src="/frontend/src/js/businessInfo.js"></script>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <img id="business-image" src="/frontend/src/assets/images/default-image.png" alt="İşletme Fotoğrafı" />
      <h1 id="sidebar-h1">Varsayılan İşletme</h1>
      <h2 id="sidebar-h2">Panel</h2>
      <nav>
        <ul>
          <li><a href="/frontend/public/pages/musteri_panel/randevu_al/index1.html">Randevu Al</a></li>
          <li><a href="/frontend/public/pages/musteri_panel/galeri/index15.html">Galeri</a></li>
          <li><a href="/frontend/public/pages/musteri_panel/sss/index3.html">Sıkça Sorulan Sorular</a></li>
          <li><a href="/frontend/public/pages/musteri_panel/iletisim/index2.html">İletişim</a></li>
        </ul>
      </nav>
    </aside>

    <button class="mobile-menu-toggle" id="menu-toggle">&#9776;</button>

    <header class="mobile-header" id="mobile-header">
      <img id="mobile-business-image" src="/frontend/src/assets/images/default-image.png" alt="İşletme Fotoğrafı" />
      <h1 id="mobile-business-name">İşletme Adı</h1>
    </header>

    <div class="mobile-menu" id="mobile-menu">
      <ul>
        <li><a href="/frontend/public/pages/musteri_panel/randevu_al/index1.html">Randevu Al</a></li>
        <li><a href="/frontend/public/pages/musteri_panel/galeri/index15.html">Galeri</a></li>
        <li><a href="/frontend/public/pages/musteri_panel/sss/index3.html">Sıkça Sorulan Sorular</a></li>
        <li><a href="/frontend/public/pages/musteri_panel/iletisim/index2.html">İletişim</a></li>
      </ul>
    </div>

    <main class="main-content">
      <h2>Galeri</h2>
      <section class="gallery-grid" id="gallery"></section>
    </main>
  </div>

 <!-- Modal -->
<div id="modal" class="modal">
  <span class="close" id="close">×</span>
  <span class="arrow left-arrow" id="prev">&#10094;</span>
  <div id="modal-images" class="modal-images"></div>
  <span class="arrow right-arrow" id="next">&#10095;</span>
</div>

 <script>
  let aktifIndex = -1;
  let globalGaleriListesi = [];

  document.addEventListener("DOMContentLoaded", async function () {
    await loadBusinessInfo();
    await loadGallery();
  });

window.addEventListener("DOMContentLoaded", async () => {
    try {
        const response = await fetch("http://localhost:8000/api/genel-ayarlar/liste");
        const ayarlar = await response.json();
        const ayar = ayarlar[0];

        if (ayar) {
            // Ana başlık ve alt başlığı tüm sayfalarda güncelle
            if (ayar.logo) {
                    document.getElementById("business-image").src = ayar.logo;
                    const mobileImage = document.getElementById("mobile-business-image");
                    if (mobileImage) mobileImage.src = ayar.logo;
            }

            if (ayar.isletme_adi) {
                document.getElementById("sidebar-h1").textContent = ayar.isletme_adi;
                const mobileName = document.getElementById("mobile-business-name");
                if (mobileName) mobileName.textContent = ayar.isletme_adi;
            }

            if (ayar.aciklama) {
                const subtitle = document.getElementById("sidebar-h2");
                if (subtitle) subtitle.textContent = ayar.aciklama;
            }
        }
    } catch (error) {
        console.error("Genel ayarlar alınamadı:", error);
    }
});


  async function loadGallery() {
    try {
      const response = await fetch("http://localhost:8000/api/galeri");
      const galeri = await response.json();
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";

      if (galeri.length === 0) {
        gallery.innerHTML = "<p></p>";
        return;
      }

      galeri.forEach((item) => {
        const imgElement = document.createElement("img");
        imgElement.src = "http://localhost:8000" + item.resim;
        imgElement.classList.add("gallery-photo");
        imgElement.addEventListener("click", () => openModal(galeri, item));
        gallery.appendChild(imgElement);
      });
    } catch (error) {
      console.error("Galeri yüklenirken hata:", error);
      document.getElementById("gallery").innerHTML = "<p>Galeri yüklenirken bir hata oluştu.</p>";
    }
  }

  function openModal(galeriListesi, aktifItem) {
    const modal = document.getElementById("modal");
    const modalImagesContainer = document.getElementById("modal-images");
    modalImagesContainer.innerHTML = "";

    globalGaleriListesi = galeriListesi;
    aktifIndex = galeriListesi.findIndex((item) => item.resim === aktifItem.resim);

    galeriListesi.forEach((item) => {
      const img = document.createElement("img");
      img.src = "http://localhost:8000" + item.resim;
      modalImagesContainer.appendChild(img);
    });

    modal.style.display = "flex";

    setTimeout(() => {
      const imgs = modalImagesContainer.querySelectorAll("img");
      if (aktifIndex !== -1) {
        imgs[aktifIndex].scrollIntoView({ behavior: "auto", inline: "center" });
      }
    }, 100);
  }

  function scrollToCurrentImage() {
    const imgs = document.querySelectorAll("#modal-images img");
    if (imgs.length === 0 || aktifIndex === -1) return;
    imgs[aktifIndex].scrollIntoView({ behavior: "smooth", inline: "center" });
  }

  document.getElementById("next").addEventListener("click", () => {
    const imgs = document.querySelectorAll("#modal-images img");
    if (imgs.length === 0) return;
    aktifIndex = (aktifIndex + 1) % imgs.length;
    scrollToCurrentImage();
  });

  document.getElementById("prev").addEventListener("click", () => {
    const imgs = document.querySelectorAll("#modal-images img");
    if (imgs.length === 0) return;
    aktifIndex = (aktifIndex - 1 + imgs.length) % imgs.length;
    scrollToCurrentImage();
  });

  const menuToggle = document.getElementById("menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");

  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener("click", () => {
      mobileMenu.classList.toggle("open");
    });
  }

  document.getElementById("close").addEventListener("click", () => {
    document.getElementById("modal").style.display = "none";
  });
</script>

</body>
</html>
